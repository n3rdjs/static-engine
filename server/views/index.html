<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/codemirror.css">
<style>

body {
    margin: 0;
}

.left_side {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 40vw;
}

.right_side {
    position: fixed;
    left: 40vw;
    top: 0;
    width: 60vw;
}

.CodeMirror {
	border: 1px solid #ccc;
    height: 100vh;
}

#calc {
    width: 100%;
    height: 55px;
}

</style>
</head>
<body>
<div class="left_side">
<button id="calc">calc</button>
<textarea id="source" name="source" style="border: 1px solid #d8d8d8">
function func() {
    return 0;
}
</textarea>
</div>
<div class="right_side">
<nav class="navbar navbar-expand-sm bg-dark navbar-dark justify-content-center">
<ul class="navbar-nav nav" id="myTab">
    <li class="nav-item">
        <a class="nav-link active" href="#info">INFO</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#ast">AST</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#cfg">CFG</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#log">LOG</a>
    </li>
</ul>
</nav>
<div>
        <div class="tab-content">
                <div id="info" class="tab-pane fade show active">
                  <h3>HOME</h3>
                  <p>Some content.</p>
                </div>
                <div id="ast" class="tab-pane fade">
                  <h3>Menu 1</h3>
                  <p>Some content in menu 1.</p>
                </div>
                <div id="cfg" class="tab-pane fade">
                    <div id="cfg-draw"></div>
                </div>
                <div id="log" class="tab-pane fade">
                  <h3>Menu 3</h3>
                  <p>Some content in menu 3.</p>
                </div>
              </div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="/static/js/codemirror.js"></script>
<script src="/static/js/javascript.js"></script>
<script src="/static/js/viz.js"></script>
<script src="/static/js/full.render.js"></script>
<script>
// Enable navbar tab
$('#myTab a').on('click', function (e) {
  e.preventDefault()
  $(this).tab('show')
})
// Set editor
var editor = CodeMirror.fromTextArea(source, {
    mode:  "javascript",
    lineNumbers: true,
    viewportMargin: Infinity,
    lineWrapping: true,
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
});
$('#calc').on('click', function (e) {
    let code = editor.getValue();
    let data = {
        code: code,
    }
    fetch('/analyze', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    }).then(function(response) {
        response.json().then((data) => {
            console.log(data);
            if(data.success) {
                let viz = new Viz();
                viz.renderSVGElement(data.cfg)
                .then((element) => {
                    let area = document.getElementById("cfg-draw");
                    area.innerHTML = ''
                    area.appendChild(element);
                })
                .catch((error) => {
                    viz = new Viz();
                    alert(error);
                })
            }
            else {
                alert(data.message);
            }
        });
    })
})

</script>
</body>
</html>